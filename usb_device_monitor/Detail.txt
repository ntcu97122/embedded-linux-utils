#!/bin/bash
Shebangï¼Œè¡¨ç¤ºé€™å€‹è…³æœ¬æœƒç”¨ /bin/bash ä¾†åŸ·è¡Œï¼ˆå³ Bash shellï¼‰ã€‚
æ˜¯æ‰€æœ‰ Bash è…³æœ¬çš„é–‹é ­æ¨™æº–ã€‚

command -v udevadm >/dev/null 2>&1 || { echo >&2 "udevadm æœªå®‰è£ï¼Œè«‹å…ˆå®‰è£ã€‚"; exit 1; }
command -v udevadmï¼šæª¢æŸ¥ç³»çµ±ä¸­æ˜¯å¦æœ‰å®‰è£ udevadm æŒ‡ä»¤ã€‚

>/dev/null 2>&1ï¼šæŠŠæ¨™æº–è¼¸å‡ºèˆ‡éŒ¯èª¤éƒ½ä¸Ÿæ‰ï¼ˆä¸é¡¯ç¤ºåœ¨è¢å¹•ä¸Šï¼‰ã€‚
>/dev/null
æŠŠã€Œæ¨™æº–è¼¸å‡º stdoutã€ä¸Ÿé€²é»‘æ´ /dev/nullï¼ˆ= ä¸é¡¯ç¤ºåœ¨ç•«é¢ä¸Šï¼‰

2>&1
æŠŠã€Œæ¨™æº–éŒ¯èª¤ stderrã€ä¹Ÿå°å‘åˆ°è·Ÿæ¨™æº–è¼¸å‡ºä¸€æ¨£çš„åœ°æ–¹ï¼ˆå³ /dev/nullï¼‰

2 æ˜¯éŒ¯èª¤è¼¸å‡ºçš„æª”æ¡ˆç·¨è™Ÿï¼Œ>&1 è¡¨ç¤ºè·Ÿã€Œæ¨™æº–è¼¸å‡ºï¼ˆ1ï¼‰ã€åŒä¸€å€‹åœ°æ–¹

|| { ... }ï¼šå¦‚æœä¸Šé¢é‚£è¡Œå¤±æ•—ï¼ˆä¹Ÿå°±æ˜¯æ²’æ‰¾åˆ° udevadmï¼‰ï¼Œå°±åŸ·è¡Œ {} è£¡çš„å…§å®¹ï¼š

echo >&2ï¼šå°å‡ºéŒ¯èª¤è¨Šæ¯åˆ°ã€ŒéŒ¯èª¤è¼¸å‡ºã€ã€‚

exit 1ï¼šä»¥éŒ¯èª¤ç¢¼ 1 çµæŸè…³æœ¬ã€‚

ğŸ‘‰ ç›®çš„ï¼šç¢ºä¿è…³æœ¬åŸ·è¡Œå‰ç³»çµ±å·²æœ‰å®‰è£ udevadmã€‚

echo "é–‹å§‹ç›£æ§ USB æ’å…¥/æ‹”é™¤äº‹ä»¶... (Ctrl+C çµæŸ)"
æç¤ºä½¿ç”¨è€…è…³æœ¬é–‹å§‹åŸ·è¡Œï¼Œä¸¦æé†’å¯ä»¥ç”¨ Ctrl+C çµæŸç›£æ§ã€‚

udevadm monitor --udev --subsystem-match=usb | while read line; do
udevadm monitorï¼šå•Ÿå‹•å³æ™‚ç›£æ§ udev äº‹ä»¶ï¼ˆè£ç½®æ’æ‹”ç­‰ï¼‰ã€‚

--udevï¼šåªç›£æ§ä½¿ç”¨è€…ç©ºé–“çš„äº‹ä»¶ï¼ˆä¸åŒ…å« kernel å±¤ï¼‰ã€‚

--subsystem-match=usbï¼šåªé‡å° USB è£ç½®çš„äº‹ä»¶ã€‚

| while read line; doï¼šæŠŠæ¯ä¸€è¡Œäº‹ä»¶è³‡è¨Šå‚³å…¥è¿´åœˆä¸­é€è¡Œè™•ç†ã€‚

echo "$(date '+%Y-%m-%d %H:%M:%S') | $line"
date '+%Y-%m-%d %H:%M:%S'ï¼šå–å¾—ç›®å‰æ™‚é–“ï¼ˆå¹´æœˆæ—¥æ™‚åˆ†ç§’ï¼‰ã€‚

echo "... | $line"ï¼šæŠŠæ™‚é–“èˆ‡äº‹ä»¶è³‡è¨Šå°åœ¨åŒä¸€è¡Œã€‚

udevadm æ˜¯ Linux ç³»çµ±ä¸­ udev çš„ç®¡ç†å·¥å…·ï¼Œå°ˆé–€ç”¨ä¾†ç®¡ç†èˆ‡ç›£æ§ã€Œè£ç½®äº‹ä»¶ã€çš„æŒ‡ä»¤å·¥å…·ï¼Œå¸¸è¦‹æ–¼åµŒå…¥å¼èˆ‡æ¡Œé¢ç³»çµ±ä¸­ã€‚

udevadm = udev adminï¼Œç”¨é€”åŒ…æ‹¬ï¼š

åŠŸèƒ½	æŒ‡ä»¤ç¯„ä¾‹	èªªæ˜
å³æ™‚ç›£æ§è£ç½®äº‹ä»¶	udevadm monitor	ç›£çœ‹å“ªäº›è£ç½®è¢«æ’å…¥ã€ç§»é™¤
æŸ¥çœ‹è£ç½®è©³ç´°è³‡è¨Š	udevadm info --query=all --name=/dev/sda	é¡¯ç¤ºè£ç½®çš„å±¬æ€§ï¼ˆå¦‚å» ç‰Œã€åºè™Ÿï¼‰
æ¸¬è©¦è¦å‰‡æ˜¯å¦æœƒè§¸ç™¼	udevadm test /sys/class/usb_device/usb1	æ¨¡æ“¬äº‹ä»¶ï¼Œæ¸¬è©¦ udev rule
é‡æ–°è¼‰å…¥ udev è¨­å®š	udevadm control --reload-rules	ç·¨è¼¯å®Œ /etc/udev/rules.d/ å¾Œè¦ reload

command -v æ˜¯ä¸€å€‹ ç”¨ä¾†ç¢ºèªæŒ‡ä»¤æ˜¯å¦å­˜åœ¨ çš„å¸¸è¦‹ shell å·¥å…·æŒ‡ä»¤ï¼Œåœ¨ Bashï¼ˆå’Œå…¶ä»– POSIX shellï¼‰ä¸­éå¸¸å¯¦ç”¨ã€‚
